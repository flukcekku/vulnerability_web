// public/scanvul.js
document.getElementById('scanvulbtn').addEventListener('click', () => {
    // const inputUrl = document.getElementById('inputUrl').value;
    const inputUrl = document.getElementsByClassName('linkToScan')[0].value;

    fetchCertificate(inputUrl);
    fetchLocation(inputUrl);
    fetchWebserverEnginehttp(inputUrl);
    fetchScanvul(inputUrl);
});

function fetchScanvul(url) {
    console.log('client function fetchScanvul working...')
    fetch(`/scanvul?url=${url}`)
    .then(response => response.text())
    .then(result => {
        console.log(result);
        document.getElementById('scanvul').innerText = result;
    })
    .catch(error => {
        console.error('Error:', error);
    });
}

async function fetchCertificate(url) {
    console.log('client function fetchCertificate working...')

    try {
        const response = await fetch(`/certificate?url=${url}`)
        const result = await response.json();

        console.log(result);
        document.getElementById('Certificate').innerText = result;
    } catch (error) {
        console.error('Error:', error);
    }
    fetch()
    .then(response => response.text())
    .then(result => {
        
        

        if (result["valid"] == true && res == 1) {
            switch (Math.sign(result['daysRemaining'])) {
                case 1:
                    document.getElementById('Certificate_icon').style.color = 'green'
                    document.getElementById("dayremaining").innerHTML = res + ' remaining';
                    console.log('มันเข้า 1 ด้วย')
                    break
                case -1:
                    document.getElementById('Certificate_icon').style.color = 'red'
                    document.getElementById("dayremaining").innerHTML = daysRemaining + ' day expired';
                    console.log('มันเข้า -1 ด้วย')
                    break
                case 0:
                    document.getElementById('Certificate_icon').style.color = 'red'
                    document.getElementById("dayremaining").innerHTML = 'Today expired';
                    console.log('มันเข้า 0 ด้วย')
                    break
                case -0:
                    document.getElementById("dayremaining").innerHTML = '-0';
                    console.log('มันเข้า -0 ด้วย')
                    break
                case NaN:
                    document.getElementById("dayremaining").innerHTML = 'NaN';
                    console.log('มันเข้า NaN ด้วย')
                    break
                default:
                    document.getElementById("dayremaining").innerHTML = 'อยู่เหนือความคาดหมาย';
                    break

            }
        } else if (result["valid"] == true && check_day == -1) {
            document.getElementById('Certificate_icon').style.color = 'red'
            document.getElementById("dayremaining").innerHTML = 'not extend validate';
        } else if (result["valid"] == false) {
            document.getElementById('Certificate_icon').style.color = 'red'
            document.getElementById("dayremaining").innerHTML = 'Fake validate';
        }

    })
    .catch(error => {
        
    });

}

function fetchLocation(url) {
    console.log('client function fetchLocation working...')
    fetch(`/Location?url=${url}`)
    .then(response => response.text())
    .then(result => {
        console.log(result);
        document.getElementById('Location').innerText = result;
    })
    .catch(error => {
        console.error('Error:', error);
    });
}

function fetchWebserverEnginehttp(url) {
    console.log('client function fetchWebserverEnginehttp working...')
    fetch(`/webserver?url=${url}`)
    .then(response => response.text())
    .then(result => {
        console.log(result);
        document.getElementById('WebserverEnginehttp').innerText = result;
    })
    .catch(error => {
        console.error('Error:', error);
    });
}